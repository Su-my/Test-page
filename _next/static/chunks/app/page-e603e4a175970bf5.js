(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5011:function(e,t,a){Promise.resolve().then(a.bind(a,6774))},6774:function(e,t,a){"use strict";a.r(t);var r=a(7437),l=a(2265),n=a(547),i=a(2007),s=a(8267),o=a(265),d=a(9108),c=a(8924),u=a(4110),p=a(3650),m=a(1880),x=a(7185),h=a(1039),f=a(531);a(4123);var y=a(9816);a(895);let{Title:g,Paragraph:j}=n.default;function v(e,t){return Math.min(Math.max(e+Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random())*t,0),50)}let A=(e,t)=>Math.random()*(t-e)+e,M=e=>{let t=[],a=0,r=0;for(;t.length<e;){let e=A(10,40);t.push(e),e>a?(r=a,a=e):e>r&&(r=e)}if(a-r<1||a-r>2){let e=A(1,2);t[t.indexOf(a)]=r+e}return{ExpectedRewards:t,variance:Array.from({length:e},()=>Math.floor(A(1,10)))}};t.default=()=>{let[e,t]=(0,l.useState)(3),[a,n]=(0,l.useState)(30),A=(0,l.useRef)(e),Z=(0,l.useRef)(a),[S,k]=(0,l.useState)([]),[w,C]=(0,l.useState)([]),[b,R]=(0,l.useState)([,,,].fill(0)),[E,B]=(0,l.useState)([,,,].fill(0)),[P,z]=(0,l.useState)([,,,].fill(0)),[F,N]=(0,l.useState)([,,,].fill(0).map(()=>Array(30).fill(0)).map((e,t)=>e.map((e,a)=>v(S[t],w[t])))),[_,I]=(0,l.useState)(0),[T,D]=(0,l.useState)(Array(30).fill(0)),[q,O]=(0,l.useState)(!1),[V,U]=i.ZP.useMessage(),[G,H]=(0,l.useState)([,,,].fill(1/0)),[J,K]=(0,l.useState)(Math.floor(Math.random()*e));(0,l.useEffect)(()=>{R(Array(e).fill(0)),B(Array(e).fill(0)),z(Array(e).fill(0));let{ExpectedRewards:t,variance:r}=M(e);k(t),C(r),N(Array(e).fill(0).map(()=>Array(a).fill(0)).map((e,a)=>e.map((e,l)=>v(t[a],r[a]))))},[e]),(0,l.useEffect)(()=>{D(Array(a).fill(0)),N(Array(e).fill(0).map(()=>Array(a).fill(0)).map((e,t)=>e.map((e,a)=>v(S[t],w[t]))))},[a]),(0,l.useEffect)(()=>{I(P.reduce((e,t)=>e+t,0));let e=b.map((e,t)=>(P[t]>0?e/P[t]:0)+(P[t]>0?1*Math.sqrt(2*Math.log(_+1)/P[t]):1/0));H(e);let t=Math.max(...e),a=e.map((e,a)=>e===t?a:-1).filter(e=>-1!==e);K(a[Math.floor(Math.random()*a.length)]),console.log(e)},[P]);let L=T.reduce((e,t)=>e+t,0).toFixed(2),Q=e=>{if(_>=a){V.open({type:"error",content:"已达到最大步数上限 ".concat(a,"，请点击“Clear output”清除。")});return}let t=F[e][_];D(e=>{let a=[...e];return a[_]=t,a}),R(a=>{let r=[...a];return r[e]+=t,r}),B(a=>{let r=[...a];return r[e]+=Math.pow(t,2),r}),z(t=>{let a=[...t];return a[e]+=1,a})},W=()=>{R(Array(e).fill(0)),B(Array(e).fill(0)),z(Array(e).fill(0)),D(Array(a).fill(0))},X=S.map((e,t)=>{var a;return{key:t,arm:"Arm ".concat(t+1),expectedReward:e.toFixed(2),variance:(null===(a=w[t])||void 0===a?void 0:a.toFixed(2))||0}}),[Y,$]=(0,l.useState)(!1);return(0,r.jsxs)("div",{className:"slot-machine-frame",style:{padding:"20px 300px"},children:[U,(0,r.jsxs)("div",{children:[(0,r.jsx)(g,{level:1,style:{textAlign:"center"},children:"Multi-Armed Bandit"}),(0,r.jsxs)(s.Z,{gutter:16,justify:"center",children:[(0,r.jsx)(o.Z,{span:8,children:(0,r.jsx)(d.Z,{addonBefore:"设置 Arm 个数",defaultValue:e,onChange:e=>{A.current=e},min:1,max:20})}),(0,r.jsx)(o.Z,{span:8,children:(0,r.jsx)(d.Z,{addonBefore:"设置最大 Step",defaultValue:a,onChange:e=>{Z.current=e},min:1})})]}),(0,r.jsx)("div",{style:{marginBottom:"20px"}})," ",(0,r.jsxs)(s.Z,{gutter:16,justify:"center",children:[(0,r.jsx)(o.Z,{span:4,children:(0,r.jsx)(c.ZP,{type:"primary",size:"large",onClick:()=>{t(A.current),n(Z.current),W(),O(!0);let{ExpectedRewards:r,variance:l}=M(e);k(r),C(l),N(Array(e).fill(0).map(()=>Array(a).fill(0)).map((e,t)=>e.map((e,a)=>v(r[t],l[t])))),K(Math.floor(Math.random()*e))},children:q?"Restart game":"Start game"})}),(0,r.jsx)(o.Z,{span:4,children:(0,r.jsx)(c.ZP,{type:"primary",size:"large",onClick:W,disabled:!q,children:"Clear output"})}),(0,r.jsx)(o.Z,{span:4,children:(0,r.jsx)(c.ZP,{type:"primary",size:"large",onClick:()=>{$(!0)},disabled:!q,children:"Show details"})})]}),(0,r.jsx)(u.Z,{}),(0,r.jsx)(s.Z,{gutter:16,children:Array(e).fill(null).map((e,t)=>(0,r.jsx)(o.Z,{span:8,children:(0,r.jsxs)(c.ZP,{type:"primary",block:!0,className:"slot-button",onClick:()=>Q(t),style:{marginBottom:"10px"},disabled:!q,children:["Arm ",t+1,t===J&&q&&(0,r.jsx)(p.Z,{color:"green",children:"UCB prefer"})]})},t))}),(0,r.jsxs)("div",{style:{marginTop:"20px"},children:[(0,r.jsx)(m.Z,{title:"Statistics",bordered:!0,items:[{key:"1",label:"Total steps",children:_},{key:"2",label:"Total reward",children:L}]}),(0,r.jsx)("div",{style:{marginBottom:"20px"}})," ",(0,r.jsx)(s.Z,{gutter:[16,16],children:b.map((e,t)=>(0,r.jsxs)(o.Z,{span:8,children:[" ",(0,r.jsx)(x.Z,{title:"Arm ".concat(t+1),children:(0,r.jsxs)(j,{children:[P[t]," pulls, Average reward: ",P[t]>0?(e/P[t]).toFixed(2):0]})})]},t))}),(0,r.jsx)("div",{style:{marginTop:"30px"},children:(0,r.jsx)(y.Z,{option:(()=>{let t=b.map((e,t)=>P[t]>0?e/P[t]:0),a=b.map((e,a)=>0===P[a]?0:Math.sqrt(E[a]/P[a]-Math.pow(t[a],2)));return{title:{text:"Mean Reward",left:"center"},tooltip:{trigger:"axis",formatter:e=>{let t="";return e.forEach(e=>{"Standard Deviation"===e.seriesName&&(t+="<div><strong>".concat(e.name,"</strong>: ").concat(e.value[1].toFixed(2)," (Mean) \xb1 ").concat(e.value[2].toFixed(2)," (Standard Deviation)</div>"))}),t}},xAxis:{type:"category",data:Array.from({length:e},(e,t)=>"Arm".concat(t+1))},yAxis:{type:"value",min:0,max:50},series:[{name:"Average Reward",type:"bar",data:t,itemStyle:{color:"#5470C6"},z:1},{name:"Standard Deviation",type:"custom",renderItem:(e,t)=>{let a=t.value(0),r=t.coord([a,t.value(1)+t.value(2)]),l=t.coord([a,t.value(1)-t.value(2)]),n=.1*t.size([1,0])[0],i=t.style({stroke:"#000",fill:"none"});return{type:"group",children:[{type:"line",shape:{x1:r[0],y1:r[1],x2:l[0],y2:l[1]},style:i},{type:"line",shape:{x1:r[0]-n,y1:r[1],x2:r[0]+n,y2:r[1]},style:i},{type:"line",shape:{x1:l[0]-n,y1:l[1],x2:l[0]+n,y2:l[1]},style:i}]}},data:t.map((e,t)=>[t,e,a[t]]),z:2}]}})()})})]})]}),(0,r.jsx)(h.Z,{title:"Details",onClose:()=>{$(!1)},open:Y,children:(0,r.jsx)(f.Z,{columns:[{title:"Arm",dataIndex:"arm",key:"arm"},{title:"Expected Reward",dataIndex:"expectedReward",key:"expectedReward"},{title:"Variance",dataIndex:"variance",key:"variance"}],dataSource:X,pagination:!1,style:{marginTop:"20px"}})})]})}},895:function(){}},function(e){e.O(0,[725,222,971,23,744],function(){return e(e.s=5011)}),_N_E=e.O()}]);