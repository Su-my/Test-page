(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5011:function(e,t,a){Promise.resolve().then(a.bind(a,6774))},6774:function(e,t,a){"use strict";a.r(t);var r=a(7437),l=a(2265),n=a(547),i=a(2007),s=a(8267),d=a(265),o=a(9108),c=a(8924),u=a(6487),p=a(4110),m=a(3650),x=a(1880),h=a(7185),f=a(1039),y=a(344);a(4123);var g=a(9816);a(895);let{Title:j,Paragraph:v}=n.default;function A(e,t){return Math.min(Math.max(e+Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random())*t,0),50)}let Z=(e,t)=>Math.random()*(t-e)+e,M=e=>{let t=[],a=0,r=0;for(;t.length<e;){let e=Z(10,40);t.push(e),e>a?(r=a,a=e):e>r&&(r=e)}let l=t.indexOf(a),n=t.indexOf(r);if(a-r<.5||a-r>1){let e=Z(.5,1);t[t.indexOf(a)]=r+e}let i=Array.from({length:e},()=>Math.floor(Z(1,10)));return i[l]=10,i[n]=10,{ExpectedRewards:t,variance:i}};t.default=()=>{let[e,t]=(0,l.useState)(3),[a,n]=(0,l.useState)(40),Z=(0,l.useRef)(e),S=(0,l.useRef)(a),[k,b]=(0,l.useState)([]),[w,C]=(0,l.useState)([]),[E,R]=(0,l.useState)([,,,].fill(0)),[F,z]=(0,l.useState)([,,,].fill(0)),[B,P]=(0,l.useState)([,,,].fill(0)),[N,O]=(0,l.useState)([,,,].fill(0).map(()=>Array(40).fill(0)).map((e,t)=>e.map((e,a)=>A(k[t],w[t])))),[_,I]=(0,l.useState)(0),[T,D]=(0,l.useState)(Array(40).fill(0)),[q,V]=(0,l.useState)(!1),[U,G]=i.ZP.useMessage(),[H,J]=(0,l.useState)([,,,].fill(1/0)),[K,L]=(0,l.useState)(Math.floor(Math.random()*e)),[Q,W]=(0,l.useState)(!1),[X,Y]=(0,l.useState)(!1),[$,ee]=(0,l.useState)(0);(0,l.useEffect)(()=>{console.log(N),N?ee(parseFloat(N.reduce((e,t)=>(t.forEach((t,a)=>{void 0===e[a]?e[a]=t:e[a]=Math.max(e[a],t)}),e),[]).reduce((e,t)=>e+t,0).toFixed(2))):ee(0)},[N]),(0,l.useEffect)(()=>{R(Array(e).fill(0)),z(Array(e).fill(0)),P(Array(e).fill(0));let{ExpectedRewards:t,variance:r}=M(e);b(t),C(r),O(Array(e).fill(0).map(()=>Array(a).fill(0)).map((e,a)=>e.map((e,l)=>A(t[a],r[a]))))},[e]),(0,l.useEffect)(()=>{D(Array(a).fill(0)),O(Array(e).fill(0).map(()=>Array(a).fill(0)).map((e,t)=>e.map((e,a)=>A(k[t],w[t]))))},[a]),(0,l.useEffect)(()=>{I(B.reduce((e,t)=>e+t,0));let e=E.map((e,t)=>(B[t]>0?e/B[t]:0)+(B[t]>0?5*Math.sqrt(2*Math.log(_+1)/B[t]):1/0));J(e);let t=Math.max(...e),a=e.map((e,a)=>e===t?a:-1).filter(e=>-1!==e);L(a[Math.floor(Math.random()*a.length)]),console.log(e)},[B]),(0,l.useEffect)(()=>{_>=a?Y(!0):Y(!1)},[_]);let et=T.reduce((e,t)=>e+t,0).toFixed(2),ea=e=>{if(_>=a){U.open({type:"error",content:"已达到最大步数上限 ".concat(a,"，请点击“Clear output”清除。")});return}let t=N[e][_];D(e=>{let a=[...e];return a[_]=t,a}),R(a=>{let r=[...a];return r[e]+=t,r}),z(a=>{let r=[...a];return r[e]+=Math.pow(t,2),r}),P(t=>{let a=[...t];return a[e]+=1,a})},er=()=>{R(Array(e).fill(0)),z(Array(e).fill(0)),P(Array(e).fill(0)),D(Array(a).fill(0))},el=[{key:"1",label:"Total steps",children:_},{key:"2",label:"Total reward",children:et}],en=[{key:"1",label:"Optimal total reward",children:(0,r.jsx)("div",{children:$})},{key:"2",label:"Realized Regret",children:(0,r.jsx)("div",{children:($-parseFloat(et)).toFixed(2)})}],ei=k.map((e,t)=>{var a;return{key:t,arm:"Arm ".concat(t+1),expectedReward:e.toFixed(2),variance:(null===(a=w[t])||void 0===a?void 0:a.toFixed(2))||0}}),[es,ed]=(0,l.useState)(!1);return(0,r.jsxs)("div",{className:"slot-machine-frame",style:{padding:"20px 300px"},children:[G,(0,r.jsxs)("div",{children:[(0,r.jsx)(j,{level:1,style:{textAlign:"center"},children:"Multi-Armed Bandit"}),(0,r.jsxs)(s.Z,{gutter:16,justify:"center",children:[(0,r.jsx)(d.Z,{span:8,children:(0,r.jsx)(o.Z,{addonBefore:"设置 Arm 个数",defaultValue:e,onChange:e=>{Z.current=e},min:1,max:20})}),(0,r.jsx)(d.Z,{span:8,children:(0,r.jsx)(o.Z,{addonBefore:"设置最大 Step",defaultValue:a,onChange:e=>{S.current=e},min:1})})]}),(0,r.jsx)("div",{style:{marginBottom:"20px"}})," ",(0,r.jsxs)(s.Z,{gutter:16,justify:"center",align:"middle",children:[(0,r.jsx)(d.Z,{span:4,children:(0,r.jsx)(c.ZP,{type:"primary",size:"large",onClick:()=>{t(Z.current),n(S.current),er(),V(!0);let{ExpectedRewards:r,variance:l}=M(e);b(r),C(l),O(Array(e).fill(0).map(()=>Array(a).fill(0)).map((e,t)=>e.map((e,a)=>A(r[t],l[t])))),L(Math.floor(Math.random()*e))},children:q?"Restart game":"Start game"})}),(0,r.jsx)(d.Z,{span:4,children:(0,r.jsx)(c.ZP,{type:"primary",size:"large",onClick:er,disabled:!q,children:"Clear output"})}),(0,r.jsx)(d.Z,{span:4,children:(0,r.jsx)(c.ZP,{type:"primary",size:"large",onClick:()=>{ed(!0)},disabled:!q||!X,children:"Show details"})}),(0,r.jsx)(d.Z,{span:4,children:(0,r.jsx)(u.Z,{onChange:e=>{W(e.target.checked)},children:"开启推荐"})})]}),(0,r.jsx)(p.Z,{}),(0,r.jsx)(s.Z,{gutter:16,children:Array(e).fill(null).map((e,t)=>(0,r.jsx)(d.Z,{span:8,children:(0,r.jsxs)(c.ZP,{type:"primary",block:!0,className:"slot-button",onClick:()=>ea(t),style:{marginBottom:"10px"},disabled:!q,children:["Arm ",t+1,t===K&&q&&Q&&(0,r.jsx)(m.Z,{color:"green",children:"UCB prefer"})]})},t))}),(0,r.jsxs)("div",{style:{marginTop:"20px"},children:[(0,r.jsx)(x.Z,{title:"Statistics",bordered:!0,items:el}),(0,r.jsx)("div",{style:{marginBottom:"20px"}})," ",(0,r.jsx)(s.Z,{gutter:[16,16],children:E.map((e,t)=>(0,r.jsxs)(d.Z,{span:8,children:[" ",(0,r.jsx)(h.Z,{title:"Arm ".concat(t+1),children:(0,r.jsxs)(v,{children:[B[t]," pulls, Average reward: ",B[t]>0?(e/B[t]).toFixed(2):0]})})]},t))}),(0,r.jsx)("div",{style:{marginTop:"30px"},children:(0,r.jsx)(g.Z,{option:(()=>{let t=E.map((e,t)=>B[t]>0?e/B[t]:0),a=E.map((e,a)=>0===B[a]?0:Math.sqrt(F[a]/B[a]-Math.pow(t[a],2)));return{title:{text:"Mean Reward",left:"center"},tooltip:{trigger:"axis",formatter:e=>{let t="";return e.forEach(e=>{"Standard Deviation"===e.seriesName&&(t+="<div><strong>".concat(e.name,"</strong>: ").concat(e.value[1].toFixed(2)," (Mean) \xb1 ").concat(e.value[2].toFixed(2)," (Standard Deviation)</div>"))}),t}},xAxis:{type:"category",data:Array.from({length:e},(e,t)=>"Arm".concat(t+1))},yAxis:{type:"value",min:0,max:50},series:[{name:"Average Reward",type:"bar",data:t,itemStyle:{color:"#5470C6"},z:1},{name:"Standard Deviation",type:"custom",renderItem:(e,t)=>{let a=t.value(0),r=t.coord([a,t.value(1)+t.value(2)]),l=t.coord([a,t.value(1)-t.value(2)]),n=.1*t.size([1,0])[0],i=t.style({stroke:"#000",fill:"none"});return{type:"group",children:[{type:"line",shape:{x1:r[0],y1:r[1],x2:l[0],y2:l[1]},style:i},{type:"line",shape:{x1:r[0]-n,y1:r[1],x2:r[0]+n,y2:r[1]},style:i},{type:"line",shape:{x1:l[0]-n,y1:l[1],x2:l[0]+n,y2:l[1]},style:i}]}},data:t.map((e,t)=>[t,e,a[t]]),z:2}]}})()})})]})]}),(0,r.jsxs)(f.Z,{title:"Details",onClose:()=>{ed(!1)},open:es,children:[(0,r.jsx)(y.Z,{columns:[{title:"Arm",dataIndex:"arm",key:"arm"},{title:"Expected Reward",dataIndex:"expectedReward",key:"expectedReward"},{title:"Variance",dataIndex:"variance",key:"variance"}],dataSource:ei,pagination:!1,style:{marginTop:"20px"}}),(0,r.jsx)(x.Z,{bordered:!0,items:en,column:1})]})]})}},895:function(){}},function(e){e.O(0,[725,147,971,23,744],function(){return e(e.s=5011)}),_N_E=e.O()}]);